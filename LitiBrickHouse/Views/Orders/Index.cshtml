@model IEnumerable<LitiBrickHouse.Models.Order> // Sửa namespace này cho đúng với Project của bạn
@using LitiBrickHouse.Enums

@{
    ViewData["Title"] = "Quản lý Đơn hàng";
    // Lấy status từ URL để highlight menu
    var currentStatus = Context.Request.Query["status"].ToString();
    int stt = 1;
}

<style>
    /* Bố cục tổng thể */
    body {
        background-color: #f8f9fa; /* Màu nền xám nhẹ cho dịu mắt */
        overflow-x: hidden;
    }

    .admin-wrapper {
        display: flex;
        min-height: 100vh;
    }

    /* --- SIDEBAR (MENU TRÁI) --- */
    .sidebar {
        width: 260px;
        background: #fff;
        box-shadow: 2px 0 10px rgba(0,0,0,0.05);
        padding: 20px;
        position: fixed;
        height: 100%;
        z-index: 100;
        top: 0; /* Đảm bảo dính lên trên cùng */
        left: 0;
        overflow-y: auto;
    }

    .sidebar-brand {
        font-size: 1.5rem;
        font-weight: 800;
        color: #E6007E;
        text-align: center;
        margin-bottom: 30px;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-bottom: 1px solid #eee;
        padding-bottom: 20px;
    }

    .nav-link {
        color: #555;
        font-weight: 600;
        padding: 12px 15px;
        border-radius: 10px;
        margin-bottom: 8px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

        .nav-link:hover {
            background-color: #ffeef7; /* Màu hồng nhạt khi di chuột */
            color: #E6007E;
            transform: translateX(5px);
        }

        .nav-link.active {
            background-color: #E6007E;
            color: white !important;
            box-shadow: 0 4px 6px rgba(230, 0, 126, 0.3);
        }

        .nav-link i {
            width: 25px;
            font-size: 1.1rem;
        }

    /* --- MAIN CONTENT (NỘI DUNG PHẢI) --- */
    .main-content {
        flex: 1;
        margin-left: 260px; /* Bằng độ rộng sidebar */
        padding: 30px;
        width: calc(100% - 260px);
    }

    /* Header của Content */
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }

    .page-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #333;
    }

    /* Card chứa bảng */
    .table-card {
        background: #fff;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.03);
        border: none;
        overflow: hidden; /* Bo tròn góc bảng */
    }

    .table thead th {
        background-color: #343a40;
        color: #fff;
        border: none;
        padding: 15px;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        white-space: nowrap;
    }

    .table tbody td {
        padding: 15px;
        vertical-align: middle;
        border-bottom: 1px solid #eee;
        color: #555;
    }

    .table tbody tr:hover {
        background-color: #fafafa;
    }

    /* Style cho Dropdown chọn trạng thái */
    .status-select {
        cursor: pointer;
        font-size: 0.85rem;
        padding: 5px 10px;
        border-radius: 20px;
        -webkit-appearance: none; /* Ẩn mũi tên mặc định để đẹp hơn */
        text-align: center;
    }

        .status-select:focus {
            box-shadow: none;
            outline: none;
        }

    /* Nút hành động */
    .btn-view {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: 0.2s;
        background: #e9ecef;
        color: #333;
    }

        .btn-view:hover {
            background: #17a2b8;
            color: white;
        }

</style>

<div class="admin-wrapper">

    <div class="sidebar">
        <div class="sidebar-brand">
            <i class="fas fa-cubes"></i> Admin Panel
        </div>

        <nav class="nav flex-column">
            <a href="@Url.Action("Index", "Admin")" class="nav-link">
                <span><i class="fas fa-chart-line"></i> Dashboard</span>
            </a>

            <div class="mt-4 mb-2 text-muted text-uppercase fw-bold" style="font-size: 0.75rem; padding-left: 15px;">Quản lý đơn hàng</div>

            <a href="@Url.Action("Index", "Orders")" class="nav-link @(string.IsNullOrEmpty(currentStatus) ? "active" : "")">
                <span><i class="fas fa-list"></i> Tất cả đơn</span>
            </a>

            <a href="@Url.Action("Index", "Orders", new { status = OrderStatus.Moi })" class="nav-link @(currentStatus == OrderStatus.Moi.ToString() ? "active" : "")">
                <span><i class="fas fa-bell"></i> Đơn Mới</span>
                @* Nếu muốn hiện số lượng badge, bạn cần ViewBag.CountNew từ Controller *@
                @if (ViewBag.CountNew > 0)
                {
                    <span class="badge bg-danger rounded-pill ms-auto">@ViewBag.CountNew</span>
                }
            </a>

            <a href="@Url.Action("Index", "Orders", new { status = OrderStatus.DangLam })" class="nav-link @(currentStatus == OrderStatus.DangLam.ToString() ? "active" : "")">
                <span><i class="fas fa-tools"></i> Đang làm</span>
            </a>

            <a href="@Url.Action("Index", "Orders", new { status = OrderStatus.HoanThanh })" class="nav-link @(currentStatus == OrderStatus.HoanThanh.ToString() ? "active" : "")">
                <span><i class="fas fa-check-circle"></i> Đã xong</span>
            </a>

            <a href="@Url.Action("Index", "Orders", new { status = OrderStatus.DaHuy })" class="nav-link @(currentStatus == OrderStatus.DaHuy.ToString() ? "active" : "")">
                <span><i class="fas fa-times-circle"></i> Đã hủy</span>
            </a>
        </nav>
    </div>

    <div class="main-content">

        <div class="page-header">
            <div>
                <h2 class="page-title">Danh Sách Đơn Hàng</h2>
                <p class="text-muted mb-0">Quản lý và cập nhật trạng thái đơn hàng</p>
            </div>
            <div>
                <button class="btn btn-outline-dark btn-sm"><i class="fas fa-download"></i> Xuất Excel</button>
            </div>
        </div>

        <div class="card table-card">
            <div class="table-responsive">
                <table class="table mb-0">
                    <thead>
                        <tr>
                            <th class="text-center" width="5%">STT</th>
                            <th width="20%">Khách Hàng</th>
                            <th width="15%">Liên Hệ</th>
                            <th width="15%">Ghi Chú</th>
                            <th width="15%">Ngày Đặt</th>
                            <th width="10%">Tổng Tiền</th>
                            <th width="15%" class="text-center">Trạng Thái</th>
                            <th width="5%" class="text-center">Xem</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            foreach (var item in Model)
                            {
                                <tr>
                                    <td class="text-center">@(stt++)</td>
                                    <td>
                                        <div class="fw-bold text-dark">@item.CustomerName</div>
                                        <small class="text-muted"><i class="fab fa-facebook-messenger"></i> @(item.SocialMediaName ?? "-")</small>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center mb-1">
                                            <i class="fas fa-phone-alt fa-xs text-muted me-2"></i> @item.PhoneNumber
                                        </div>
                                        <div class="text-truncate" style="max-width: 150px;" title="@item.Address">
                                            <i class="fas fa-map-marker-alt fa-xs text-muted me-2"></i> @item.Address
                                        </div>
                                    </td>
                                    <td class="small text-muted fst-italic">
                                        @(string.IsNullOrEmpty(item.Note) ? "-" : item.Note)
                                    </td>
                                    <td>@item.OrderDate.ToString("dd/MM/yyyy") <br> <small class="text-muted">@item.OrderDate.ToString("HH:mm")</small></td>
                                    <td class="fw-bold text-danger">@item.TotalPrice.ToString("N0")</td>

                                    <td class="text-center">
                                        <form asp-action="UpdateStatus" method="post">
                                            <input type="hidden" name="id" value="@item.Id" />

                                            <select name="newStatus" class="form-select status-select fw-bold text-white border-0"
                                                    style="background-color: @(item.Status == OrderStatus.Moi ? "#fd7e14" :
                                                                                                                                    item.Status == OrderStatus.DangLam ? "#0d6efd" :
                                                                                                                                    item.Status == OrderStatus.HoanThanh ? "#198754" : "#dc3545");"
                                            onchange="this.form.submit()">

                                                <option value="@OrderStatus.Moi" selected="@(item.Status == OrderStatus.Moi)">Đơn Mới</option>
                                                <option value="@OrderStatus.DangLam" selected="@(item.Status == OrderStatus.DangLam)">Đang Làm</option>
                                                <option value="@OrderStatus.HoanThanh" selected="@(item.Status == OrderStatus.HoanThanh)">Đã Xong</option>
                                                <option value="@OrderStatus.DaHuy" selected="@(item.Status == OrderStatus.DaHuy)">Đã Hủy</option>
                                            </select>
                                        </form>
                                    </td>

                                    <td class="text-center">
                                        <a asp-action="Details" asp-route-id="@item.Id" class="btn-view" title="Xem chi tiết">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                                }
                        }
                        else
                        {
                            <tr>
                                <td colspan="8" class="text-center py-5 text-muted">
                                    <i class="fas fa-inbox fa-3x mb-3" style="color: #dee2e6;"></i><br>
                                    Chưa có đơn hàng nào trong mục này
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>